<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>时光机</title>
    <style>
			body {
				margin: 0;
				overflow: hidden;
			}
    </style>
    <script src="https://www.unpkg.com/three@0.154.0/build/three.js"></script>
</head>
<body>
<script>
	// 创建场景 scene 和 renderer
	const width = window.innerWidth;
	const height = window.innerHeight;
	
	const scene = new THREE.Scene();
	const renderer = new THREE.WebGLRenderer();
	// 创建相机
	const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);

	renderer.setSize(width, height);
	camera.position.set(0, 0, 500);
	camera.lookAt(scene.position);

	// 光源
	const pointLight = new THREE.PointLight( 0xffffff );
	pointLight.position.set(0, 0, 500);
	scene.add(pointLight);

	document.body.appendChild(renderer.domElement)

	let tunnel;
	let stormTexture;
	function create() {
		// 处理贴图
		const textureLoader = new THREE.TextureLoader();
		textureLoader.load('storm.jpg', function(texture) {
			stormTexture = texture;

			texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
			texture.repeat.set( 1, 2 );

			// 创建圆柱体
			const geometry = new THREE.CylinderGeometry( 30, 50, 1000, 32, 32, true);

			// MeshPhongMaterial 的材质，这种材质有金属质感，会反光
			const material = new THREE.MeshPhongMaterial({ 
				transparent: true,
				alphaMap: texture,
				side: THREE.BackSide
			});
			tunnel = new THREE.Mesh(geometry, material);

			tunnel.rotation.x = -Math.PI / 2;

			scene.add(tunnel);
		});

		// 时光机的底座 立方体
		textureLoader.load('metal.png', function(texture) {
			texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
			texture.repeat.set( 10, 10 );

			const geometry = new THREE.BoxGeometry( 30, 2, 30 ); 

			const material = new THREE.MeshPhongMaterial( {
				map: texture
			});

			const cube = new THREE.Mesh( geometry, material ); 
			cube.position.z = 460;
			cube.position.y = -20;
			scene.add( cube );
		});	
	}

	let H = 0;
	// 设置不同的颜色
	function render() {
		renderer.render(scene, camera);

		H += 0.002;
		if (H > 1) { H = 0; }

		if(tunnel) {
			tunnel.material.color.setHSL(H, 0.5, 0.5);

			tunnel.rotation.y += 0.01;
			stormTexture.offset.y += 0.01;
		}
		requestAnimationFrame(render);
	}

	create();
	render();

</script>
</body>
</html>
